<html>
    <head>
        <title>FC 모바일 진화 시뮬레이터
        </title>
        <meta name="viewport" content="user-scalable=no;" /> 
        <meta property="og:title" content="FC 모바일 진화 시뮬레이터">
        <meta property="og:description" content="FC 모바일 진화 시뮬레이터">
        <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="Anonymous"></script>
        <script src = "https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
        <link href='https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css' rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="result_style.css" />
        <script src="./scripts/cardList.js"></script>
        <script src="https://indvel.github.io/fcmsquad/resources/clubsList.js"></script>
        <script src="https://indvel.github.io/fcmsquad/resources/fcmData.js"></script>
        <script src="https://indvel.github.io/fcmsquad/resources/faceData.js"></script>
        <script src="https://indvel.github.io/fcmsquad/resources/faceData2.js"></script>
        <script src="https://indvel.github.io/fcmsquad/resources/fco_allp.js"></script>
        <script>
            $(document).ready(function(){
                $(document).bind('keydown',function(e){
                    if ( e.keyCode == 123) {
                        e.preventDefault();
                        e.returnValue = false;
                    }
                });
            });
        </script>
    </head>
    <body oncontextmenu="return false" ondragstart="return false" onselectstart="return false">
        <div class="div-contents">
            <div class="simul-main">
                <span class="result-text"></span>
                <div class="main-div">
                    <div id="capture">
                        <div class="anim-box"></div>
                        <div class="img-div">
                            <img id="card-img" src="https://indvel.github.io/fcmsquad/resources/cards/PremiumBase.png"/>
                        </div>
                        <div class="face-div">
                            <img id="card-face" src=""/>
                        </div>
                        <div class="ovr-div">
                            <span id="card-ovr"></span>
                        </div>
                        <div class="icon-div">
                            <img id="card-icon" src="./resources/icons/Evolution/EV1.png"/>
                        </div>
                        <div class="name-div">
                            <span id="card-name"></span>
                        </div>
                    </div>
                </div>
                <div class="div-simulator">
                    <div class="div-title">카드 선택</div>
                    <div class="div-card">
                        <select class="form-select" id="card-select" aria-label="카드 선택">
                            
                        </select>
                    </div>
                    <br>
                    <div class="div-title">진화 등급 선택(현재 등급)</div>
                    <div class="div-evo">
                        <select class="form-select" id="evo-select" aria-label="진화 선택">
                            <option value="EV0">0진 -> 1진</option>
                            <option value="EV1">1진 -> 2진</option>
                            <option value="EV2">2진 -> 3진</option>
                            <option value="EV3">3진 -> 4진</option>
                            <option value="EV4">4진 -> 5진</option>
                            <option value="EV5">5진 -> 6진</option>
                            <option value="EV6">6진 -> 7진</option>
                            <option value="EV7">7진 -> 8진</option>
                            <option value="EV8">8진 -> 9진</option>
                            <option value="EV9">9진 -> 10진</option>
                        </select>
                    </div>
                    <br>
                    <div class="div-title">진화 게이지</div>
                    <div class="div-gauge">
                        <ul class="gauge-list">
                            <li class="gauge" id="gauge1"></li>
                            <li class="gauge" id="gauge2"></li>
                            <li class="gauge" id="gauge3"></li>
                            <li class="gauge" id="gauge4"></li>
                            <li class="gauge" id="gauge5"></li>
                        </ul>
                    </div>
                    <div class="div-title" id="success-info">성공 확률: 100%</div>
                    <br>
                    <div class="bottom-div">
                        <div class="checks">
                            <div id="check-div" class="form-check form-switch" style="margin: 4px">
                                <input class="form-check-input" type="checkbox" role="switch" id="checkKeep">
                                <label class="form-check-label" for="checkKeep" id="checkLabel">진화 등급 보호권</label>
                            </div>
                            <div id="check-div" class="form-check form-switch" style="margin: 4px">
                                <input class="form-check-input" type="checkbox" role="switch" id="checkKeep2">
                                <label class="form-check-label" for="checkKeep2" id="checkLabel">성공 시 등급 유지</label>
                            </div>
                            <div id="check-div" class="form-check form-switch" style="margin: 4px">
                                <input class="form-check-input" type="checkbox" role="switch" id="checkAnim">
                                <label class="form-check-label" for="checkAnim" id="checkLabel">진화 애니메이션</label>
                            </div>
                        </div>
                        <input type="button" class="btn btn-primary adder" id="btnStart" style="width: 100px; height: 60px;" value="도전" onclick="startEvolution();"/>
                    </div>
                </div>
                <span class="summary"></span>
                <div class="set-player">
                    <div class="popup-top">
                        <div class="div-title" id="player-search">
                            <span>선수 / 미페 설정</span>
                        </div>
                        <div class="open-button" onclick="closePopup();">
                            X
                        </div>
                    </div>
                    <div class="div-title">
                        <span>선수 선택</span>
                    </div>
                    <div class="inputs">
                        <input type="text" class="form-control" id="inputPlayer" placeholder="선수명 입력" onkeypress="checkEnter();" />
                        <input type="button" class="btn btn-primary adder" id="btnSearch" value="검색" onclick="searchPlayers();"/>
                    </div>
                    <div class="div-list">
                        <ul class="search-list" id="player-list">
    
                        </ul>
                    </div>
                    <div class="div-title">
                        <span>미니 페이스온 선택</span>
                    </div>
                    <select class="form-select" id="face-select" aria-label="미니 페이스온 선택">
                        
                    </select>
                </div>
            </div>
        </div>
        <footer>
            <span>ⓒ Indvel, Resource provided by FC Mobile</span>
        </footer>
    </body>
    <script>
        var sel = 0;
        var isFace = false;
        var iconOriginL = -1;
        var iconOriginT = -1;
        var selEv = 0;
        var selGauge = 5;
        var evls = [100, 100, 81, 64, 50, 26, 15, 7, 4, 2];
        var calc = 0;
        var isKeep = false;
        var isKeep2 = false;
        var counts = {try: 0, success: 0, fail: 0};
        var isEnd = false;
        var data = [];
        var faceIdx = [];
        var selected = -1;
        var isAnim = false;

        $(document).ready(function() {
            $(function() {
                cardData.forEach(function(e, idx) {
                    var opt = document.createElement("option");
                    opt.setAttribute("value", e.name);
                    opt.setAttribute("idx", idx);
                    opt.innerText = e.name;
                    document.querySelector("#card-select").appendChild(opt);
                });
            });

            document.querySelectorAll('.gauge-list > .gauge').forEach((e) => {
                e.onclick = function(evt) {
                    var val = Number(this.id.split("gauge")[1]);
                    selGauge = val;
                    for(var i = 0; i < 5; i++) {
                        if(selGauge == 5) {
                            $('#gauge' + (i + 1)).css({background: 'green'});
                        } else {
                            if(i < val) {
                                $('#gauge' + (i + 1)).css({background: 'dodgerblue'});
                            } else {
                                $('#gauge' + (i + 1)).css({background: 'gray'});
                            }
                        }
                    }
                    calc = (evls[selEv] / 5) * selGauge;
                    $('#success-info').text("성공 확률: " + calc.toFixed(1) + "%");
                }
            });
        });

        document.querySelector('#capture').onclick = function(e) {
            if($('.set-player').css('display') == 'none') {
                $('.set-player').css({display: 'block'});
            } else {
                $('.set-player').css({display: 'none'});
            }
        }

        function closePopup() {
            $('.set-player').css({display: 'none'});
        }

        function checkEnter() {
            if(event.keyCode == 13) {
                searchPlayers();
            }
        }

        function searchPlayers() {
            if($('#inputPlayer').val().length == 0) {
                $('#player-list').css({display: 'none'});
            } else {
                $('#player-list').css({display: 'block'});
                var list = document.querySelector('#player-list');
                list.innerHTML = "";
                var input = $('#inputPlayer').val();
                var f = allData.filter(v => v.name.indexOf(input) != -1 || v.originName.indexOf(input) != -1 || v.team.indexOf(input) != -1 || v.country.indexOf(input) != -1 || v.career.indexOf(input) != -1);
                if(f.length != 0) {
                    for(var i = 0; i < f.length; i++) {
                        var sch = document.createElement("li");
                        var cdx = countryData.findIndex(e => e.name == f[i].country);
                        var idx2 = -1;
                        for(var j = 0; j < ClubsData.length; j++) {
                            if(ClubsData[j].name.includes("|")) {
                                var arr = ClubsData[j].name.split("|");
                                arr.forEach(function(n) {
                                    if(n.indexOf(f[i].team) != -1) {
                                        idx2 = j;
                                        return;
                                    }
                                });
                            } else {
                                if(ClubsData[j].name.indexOf(f[i].team) != -1) {
                                    idx2 = j;
                                    break;
                                }
                            }
                        }
                        if(ClubsData[idx2] != undefined) {
                            sch.innerHTML = '<img style="width:25px;" src=' + countryData[cdx].logos + '> <img style="width:25px; height:25px;" src=' + ClubsData[idx2].logos.replace("./resources/logos", "https://indvel.github.io/fcmsquad/resources/logos") + '> ' + '<span style="color:green;">' + f[i].pos + '</span> <b>' + f[i].name + '</b>';
                        } else {
                            sch.innerHTML = '<img style="width:25px;" src=' + countryData[cdx].logos + '> <span style="color:green;">' + f[i].pos + '</span> <b>' + f[i].name + '</b>';
                        }
                        sch.onclick = function(e) {
                            var idx = allData.findIndex(e => e.name == this.innerHTML.split("<b>")[1].split("</b>")[0] && e.pos == this.innerHTML.split("<span")[1].split("</span>")[0].split(">")[1]);
                            var name = allData[Number(idx)].name;
                            if(name.length > 6 && name.length <= 13) {
                                $('#card-name').css({fontSize: 20 - Number(name.length - 7) + 'px'});
                            } else if(name.length >= 14) {
                                $('#card-name').css({fontSize: 20 - Number(name.length - 5) + 'px'});
                            } else {
                                $('#card-name').css({fontSize: '20px'});
                            }
                            $('#card-name').text(allData[Number(idx)].name);
                            getFaces(allData[Number(idx)].originName);
                            var opt = document.querySelectorAll('#face-select > option');
                            $('#face-select').prop('selectedIndex', 0).change();
                            for(var i = 0; i < opt.length; i++) {
                                if(opt[i].innerText.indexOf(cardData[sel].code) != -1) {
                                    $('#face-select').prop('selectedIndex', i).change();
                                    break;
                                }
                            }
                            $('#inputPlayer').val("");
                            $('#player-list').css({display: 'none'});
                        }
                        list.appendChild(sch);
                        $('#player-list').css({display: 'block'});
                    }
                }
            }
        }

        function getFaces(str) {
            document.querySelector("#face-select").innerHTML = "";
            var idx = fcmData.findIndex((e) => e.name == str || e.nick == str);
            var data;
            if(idx != -1) {
                if(cardData[sel].type == "fc") {
                    data = faceData;
                } else {
                    data = faceData2;
                }
                faceIdx = data.findIndex((e) => e.pid == fcmData[idx].pid);
                if(data[faceIdx].images != undefined) {
                    data[faceIdx].images.forEach(function(e, i) {
                        var opt = document.createElement("option");
                        opt.setAttribute("idx", i);
                        opt.setAttribute("fidx", faceIdx);
                        if(e.indexOf("/normal") != -1) {
                            opt.innerText = e.split("player_23_")[1].split("/normal")[0];
                        } else {
                            opt.innerText = e.split("players/")[1].split(".png")[0];  
                        }
                        
                        document.querySelector("#face-select").appendChild(opt);
                    });
                }
            }
        }

        $('#face-select').on('change', function() {
            selected = $('#face-select option:selected').attr('idx');
            faceIdx = $('#face-select option:selected').attr('fidx');
            var data;
            if(sel != -1) {
                if(cardData[sel].type == "fc") {
                    data = faceData;
                } else {
                    data = faceData2;
                }
                if(data[faceIdx] != undefined) {
                    if(data[faceIdx].images.length != 0) {
                        $('#card-face').attr('src', data[faceIdx].images[selected].replace("./resources/players", "https://indvel.github.io/fcmsquad/resources/players"));
                        data.face = data[faceIdx].images[selected];
                    }
                }
            }
        });

        $('#checkKeep').change(function(e) {
            if($(this).prop('checked')) {
                isKeep = true;
            } else {
                isKeep = false;
            }
        });

        $('#checkKeep2').change(function(e) {
            if($(this).prop('checked')) {
                isKeep2 = true;
            } else {
                isKeep2 = false;
            }
        });

        $('#checkAnim').change(function(e) {
            if($(this).prop('checked')) {
                isAnim = true;
            } else {
                isAnim = false;
            }
        });

        $('#card-select').on('change', function() {
            sel = Number($('#card-select option:selected').attr("idx"));
            applyDesign();
        });

        function applyDesign() {
            iconOriginL = -1;
            iconOriginT = -1;
            $('#card-img').attr('src', cardData[sel].image);
            $('#card-name').css({color: cardData[sel].tcolor});
            if(cardData[sel].type == "fc") {
                $('.icon-div').css({left: '130px', top: '180px'});
                $('.name-div').css({top: '160px'});
            } else if(cardData[sel].type == "fm") {
                if(cardData[sel].code.indexOf("STAR") != -1) {
                    $('.icon-div').css({left: '63px', top: '95px'});
                    $('.name-div').css({top: '190px'});
                } else {
                    $('.icon-div').css({left: '55px', top: '90px'});
                    $('.name-div').css({top: '175px'});
                }
            }
            $('#card-name').css({color: cardData[sel].color});
        }

        $('#evo-select').on('change', function() {
            if(iconOriginL == -1) {
                iconOriginL = Number($('.icon-div').css('left').split('px')[0]);
            }
            if(iconOriginT == -1) {
                iconOriginT = Number($('.icon-div').css('top').split('px')[0]);
            }
            var ev = $('#evo-select option:selected').attr('value');
            selEv = Number(ev.replace("EV", ""));
            selGauge = 5;
            document.querySelectorAll('.gauge-list > .gauge').forEach((e) => {
                $('#' + e.id).css({background: "green"});
            });
            calc = 0;
            counts = {try: 0, success: 0, fail: 0};
            $('.summary').html("");
            $('#success-info').text("성공 확률: " + evls[selEv] + "%");
            if(ev == 'EV0') {
                $('.icon-div').css({display: 'none'});
            } else {
                $('#card-icon').attr('src', './resources/icons/Evolution/' + ev + '.png');
                $('.icon-div').css({display: 'block'});
            }
            $('.result-text').text('');
            $('.result-text').css({background: 'none'});
            $('.simul-main').css({background: "url('./resources/background/bg_normal.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
            isEnd = false;
            $('#btnStart').prop('disabled', false);
        });

        function startEvolution() {
            if(isEnd) {
                isEnd = false;
                startEvolution();
            } else {
                const ranNum = Math.random() * 100;
                var target = evls[selEv];
                counts.try++;
                if(calc != 0) {
                    target = calc;
                }
                if(target >= ranNum) {
                    if(isAnim) {
                        $('.anim-box').css({opacity: '100%'});
                        $('#btnStart').prop('disabled', true);
                        sleep(1000).then(function() {
                            $('.anim-box').css({opacity: '0%'});
                            if(selEv < 9) {
                                if(!isKeep2) {
                                    selEv++;
                                    $('.icon-div').css({display: 'block'});
                                    $('#card-icon').attr('src', './resources/icons/Evolution/EV' + selEv + '.png');
                                    $('.result-text').text('진화 성공');
                                    $('.result-text').css({background: 'green'});
                                    $('.simul-main').css({background: "url('./resources/background/bg_success.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
                                    $('#success-info').text("성공 확률: " + evls[selEv] + "%");
                                    document.querySelector('#evo-select').value = "EV" + selEv;
                                    selGauge = 5;
                                    calc = 0;
                                    document.querySelectorAll('.gauge-list > .gauge').forEach((e) => {
                                        $('#' + e.id).css({background: "green"});
                                    });
                                } else {
                                    $('.result-text').text('진화 성공');
                                    $('.result-text').css({background: 'green'});
                                    if(selEv == 0) {
                                        $('.icon-div').css({display: 'none'});
                                    } else {
                                        $('.icon-div').css({display: 'block'});
                                        $('#card-icon').attr('src', './resources/icons/Evolution/EV' + selEv + '.png');
                                    }
                                    $('.simul-main').css({background: "url('./resources/background/bg_success.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
                                }
                            } else {
                                $('.icon-div').css({display: 'block'});
                                $('#card-icon').attr('src', './resources/icons/Evolution/EV10.png');
                                $('.result-text').text('진화 성공');
                                $('.result-text').css({background: 'green'});
                                $('.simul-main').css({background: "url('./resources/background/bg_success.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
                                isEnd = true;
                                $('#btnStart').prop('disabled', true);
                            }
                            counts.success++;
                            var ratio = (counts.success / counts.try) * 100;
                            $('.summary').html("시도: " + counts.try + "<br>성공: " + counts.success + " (성공률: " + ratio.toFixed(2) + "%)<br>실패: " + counts.fail);
                            $('#btnStart').prop('disabled', false);
                        });
                    } else {
                        counts.success++;
                        if(selEv < 9) {
                            if(!isKeep2) {
                                selEv++;
                                $('.icon-div').css({display: 'block'});
                                $('#card-icon').attr('src', './resources/icons/Evolution/EV' + selEv + '.png');
                                $('.result-text').text('진화 성공');
                                $('.result-text').css({background: 'green'});
                                $('.simul-main').css({background: "url('./resources/background/bg_success.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
                                $('#success-info').text("성공 확률: " + evls[selEv] + "%");
                                document.querySelector('#evo-select').value = "EV" + selEv;
                                selGauge = 5;
                                calc = 0;
                                document.querySelectorAll('.gauge-list > .gauge').forEach((e) => {
                                    $('#' + e.id).css({background: "green"});
                                });
                            } else {
                                $('.result-text').text('진화 성공');
                                $('.result-text').css({background: 'green'});
                                if(selEv == 0) {
                                    $('.icon-div').css({display: 'none'});
                                } else {
                                    $('.icon-div').css({display: 'block'});
                                    $('#card-icon').attr('src', './resources/icons/Evolution/EV' + selEv + '.png');
                                }
                                $('.simul-main').css({background: "url('./resources/background/bg_success.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
                            }
                        } else {
                            $('.icon-div').css({display: 'block'});
                            $('#card-icon').attr('src', './resources/icons/Evolution/EV10.png');
                            $('.result-text').text('진화 성공');
                            $('.result-text').css({background: 'green'});
                            $('.simul-main').css({background: "url('./resources/background/bg_success.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
                            isEnd = true;
                            $('#btnStart').prop('disabled', true);
                        }
                        var ratio = (counts.success / counts.try) * 100;
                        $('.summary').html("시도: " + counts.try + "<br>성공: " + counts.success + " (성공률: " + ratio.toFixed(2) + "%)<br>실패: " + counts.fail);
                    }
                } else {
                    if(isAnim) {
                        $('.anim-box').css({opacity: '60%'});
                        $('#btnStart').prop('disabled', true);
                        sleep(1000).then(function() {
                            $('.anim-box').css({opacity: '0%'});
                            if(!isKeep) {
                                if(selEv > 0) {
                                    selEv--;
                                    $('#card-icon').attr('src', './resources/icons/Evolution/EV' + selEv + '.png');
                                } else {
                                    $('.icon-div').css({display: 'none'});
                                }
                                $('.result-text').text('진화 실패');
                                $('.result-text').css({background: 'red'});
                                $('.simul-main').css({background: "url('./resources/background/bg_normal.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
                                $('#success-info').text("성공 확률: " + evls[selEv] + "%");
                                document.querySelector('#evo-select').value = "EV" + selEv;
                                selGauge = 5;
                                calc = 0;
                                document.querySelectorAll('.gauge-list > .gauge').forEach((e) => {
                                    $('#' + e.id).css({background: "green"});
                                });
                                counts = {try: 0, success: 0, fail: 0};
                                $('.summary').html("");
                                return 0;
                            } else {
                                $('.result-text').text('진화 실패');
                                $('.result-text').css({background: 'red'});
                                $('.simul-main').css({background: "url('./resources/background/bg_normal.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
                            }
                            counts.fail++;
                            var ratio = (counts.success / counts.try) * 100;
                            $('.summary').html("시도: " + counts.try + "<br>성공: " + counts.success + " (성공률: " + ratio.toFixed(2) + "%)<br>실패: " + counts.fail);
                            $('#btnStart').prop('disabled', false);
                        });
                    } else {
                        counts.fail++;
                        if(!isKeep) {
                            if(selEv > 0) {
                                selEv--;
                                $('#card-icon').attr('src', './resources/icons/Evolution/EV' + selEv + '.png');
                            } else {
                                $('.icon-div').css({display: 'none'});
                            }
                            $('.result-text').text('진화 실패');
                            $('.result-text').css({background: 'red'});
                            $('.simul-main').css({background: "url('./resources/background/bg_normal.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
                            $('#success-info').text("성공 확률: " + evls[selEv] + "%");
                            document.querySelector('#evo-select').value = "EV" + selEv;
                            selGauge = 5;
                            calc = 0;
                            document.querySelectorAll('.gauge-list > .gauge').forEach((e) => {
                                $('#' + e.id).css({background: "green"});
                            });
                            counts = {try: 0, success: 0, fail: 0};
                            $('.summary').html("");
                            return 0;
                        } else {
                            $('.result-text').text('진화 실패');
                            $('.result-text').css({background: 'red'});
                            $('.simul-main').css({background: "url('./resources/background/bg_normal.png')", backgroundSize: 'contain', backgroundRepeat: 'no-repeat'});
                        }
                        var ratio = (counts.success / counts.try) * 100;
                        $('.summary').html("시도: " + counts.try + "<br>성공: " + counts.success + " (성공률: " + ratio.toFixed(2) + "%)<br>실패: " + counts.fail);
                    }
                }
            }
        }

        function sleep(ms) {
            return new Promise((resolve) => setTimeout(resolve, ms))
        }
    </script>
</html>